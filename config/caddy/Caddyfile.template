# MAGI Automatic HTTPS Configuration with Caddy
# This file is auto-generated by start.sh when automatic HTTPS is enabled
#
# Caddy automatically obtains and renews Let's Encrypt certificates
# No manual certificate management required!

{
    # Global options
    email {ADMIN_EMAIL}
    
    # Automatic HTTPS is enabled by default in Caddy
    # Use Let's Encrypt production endpoint (staging for testing)
    acme_ca https://acme-v02.api.letsencrypt.org/directory
    # For testing, uncomment the line below:
    # acme_ca https://acme-staging-v02.api.letsencrypt.org/directory
}

# Main domain - Open WebUI (Cortex)
{DOMAIN} {
    # Automatic HTTPS with Let's Encrypt
    
    # Reverse proxy to Open WebUI
    reverse_proxy open-webui:8080 {
        header_up Host {host}
        header_up X-Real-IP {remote_host}
    }
    
    # Enable logging
    log {
        output file /data/access.log
    }
}

# n8n subdomain (Reflex)
n8n.{DOMAIN} {
    reverse_proxy n8n:5678 {
        header_up Host {host}
        header_up X-Real-IP {remote_host}
    }
}

# SearXNG subdomain (Vision)
search.{DOMAIN} {
    reverse_proxy searxng:8080 {
        header_up Host {host}
        header_up X-Real-IP {remote_host}
    }
}

# LiteLLM API subdomain (Router)
api.{DOMAIN} {
    reverse_proxy litellm:4000 {
        header_up Host {host}
        header_up X-Real-IP {remote_host}
    }
}

# Localhost fallback (for local development)
:80 {
    reverse_proxy open-webui:8080 {
        header_up Host {host}
        header_up X-Real-IP {remote_host}
    }
}
